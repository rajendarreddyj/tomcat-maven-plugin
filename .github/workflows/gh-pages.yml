name: GitHub Pages

on:
    push:
        branches: [main]
        paths:
            - "docs/**"
            - "src/main/java/**"
            - "README.md"
            - "pom.xml"
    workflow_dispatch:

permissions:
    contents: read
    pages: write
    id-token: write

concurrency:
    group: "pages"
    cancel-in-progress: false

jobs:
    build:
        name: Build Documentation
        runs-on: ubuntu-latest

        steps:
            - name: Checkout code
              uses: actions/checkout@v6

            - name: Set up JDK 21
              uses: actions/setup-java@v5
              with:
                  java-version: "21"
                  distribution: "temurin"
                  cache: maven

            - name: Generate Javadoc
              run: mvn -B javadoc:javadoc -DskipTests

            - name: Generate Plugin Documentation
              run: mvn -B site:site -DskipTests -DgenerateReports=false

            - name: Setup Pages
              uses: actions/configure-pages@v5

            - name: Prepare site content
              run: |
                  mkdir -p _site

                  # Copy main documentation
                  cp -r docs/* _site/ 2>/dev/null || true
                  cp README.md _site/

                  # Copy Javadoc
                  mkdir -p _site/apidocs
                  cp -r target/reports/apidocs/* _site/apidocs/ 2>/dev/null || true

                  # Copy plugin site documentation
                  cp -r target/site/* _site/ 2>/dev/null || true

                  # Create index.html
                  cat > _site/index.html << 'EOF'
                  <!DOCTYPE html>
                  <html lang="en">
                  <head>
                      <meta charset="UTF-8">
                      <meta name="viewport" content="width=device-width, initial-scale=1.0">
                      <title>Tomcat Maven Plugin</title>
                      <style>
                          :root {
                              --primary: #2563eb;
                              --secondary: #64748b;
                              --bg: #f8fafc;
                              --card-bg: #ffffff;
                              --text: #1e293b;
                              --text-light: #64748b;
                              --border: #e2e8f0;
                          }
                          * { box-sizing: border-box; margin: 0; padding: 0; }
                          body {
                              font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
                              background: var(--bg);
                              color: var(--text);
                              line-height: 1.6;
                          }
                          .container { max-width: 1200px; margin: 0 auto; padding: 2rem; }
                          header {
                              background: linear-gradient(135deg, var(--primary), #1d4ed8);
                              color: white;
                              padding: 4rem 2rem;
                              text-align: center;
                          }
                          header h1 { font-size: 2.5rem; margin-bottom: 1rem; }
                          header p { font-size: 1.25rem; opacity: 0.9; max-width: 600px; margin: 0 auto; }
                          .badges { margin-top: 1.5rem; }
                          .badges img { margin: 0 0.25rem; }
                          .cards {
                              display: grid;
                              grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
                              gap: 1.5rem;
                              margin-top: 2rem;
                          }
                          .card {
                              background: var(--card-bg);
                              border-radius: 12px;
                              padding: 1.5rem;
                              box-shadow: 0 1px 3px rgba(0,0,0,0.1);
                              border: 1px solid var(--border);
                              transition: transform 0.2s, box-shadow 0.2s;
                          }
                          .card:hover {
                              transform: translateY(-2px);
                              box-shadow: 0 4px 12px rgba(0,0,0,0.15);
                          }
                          .card h3 { color: var(--primary); margin-bottom: 0.5rem; font-size: 1.25rem; }
                          .card p { color: var(--text-light); margin-bottom: 1rem; }
                          .card a {
                              display: inline-block;
                              color: var(--primary);
                              text-decoration: none;
                              font-weight: 500;
                          }
                          .card a:hover { text-decoration: underline; }
                          .quick-start {
                              background: var(--card-bg);
                              border-radius: 12px;
                              padding: 2rem;
                              margin-top: 2rem;
                              border: 1px solid var(--border);
                          }
                          .quick-start h2 { margin-bottom: 1rem; }
                          pre {
                              background: #1e293b;
                              color: #e2e8f0;
                              padding: 1rem;
                              border-radius: 8px;
                              overflow-x: auto;
                              font-size: 0.9rem;
                          }
                          code { font-family: 'Monaco', 'Menlo', monospace; }
                          footer {
                              text-align: center;
                              padding: 2rem;
                              color: var(--text-light);
                              margin-top: 2rem;
                          }
                          footer a { color: var(--primary); text-decoration: none; }
                      </style>
                  </head>
                  <body>
                      <header>
                          <h1>Tomcat Maven Plugin</h1>
                          <p>A modern Maven plugin for deploying and managing web applications on Apache Tomcat 10.1.x and 11.x</p>
                          <div class="badges">
                              <a href="https://www.apache.org/licenses/LICENSE-2.0"><img src="https://img.shields.io/badge/License-Apache_2.0-blue.svg" alt="License"></a>
                              <a href="https://central.sonatype.com/artifact/io.github.rajendarreddyj/tomcat-maven-plugin"><img src="https://img.shields.io/maven-central/v/io.github.rajendarreddyj/tomcat-maven-plugin.svg" alt="Maven Central"></a>
                              <a href="https://www.oracle.com/java/technologies/downloads/"><img src="https://img.shields.io/badge/Java-21%2B-brightgreen.svg" alt="Java"></a>
                          </div>
                      </header>

                      <div class="container">
                          <div class="cards">
                              <div class="card">
                                  <h3>üìñ User Guide</h3>
                                  <p>Complete documentation for using the plugin including configuration, goals, and examples.</p>
                                  <a href="https://github.com/rajendarreddyj/tomcat-maven-plugin/wiki">View Wiki ‚Üí</a>
                              </div>
                              <div class="card">
                                  <h3>üìö API Documentation</h3>
                                  <p>Javadoc API reference for developers extending or contributing to the plugin.</p>
                                  <a href="apidocs/index.html">View Javadoc ‚Üí</a>
                              </div>
                              <div class="card">
                                  <h3>üèóÔ∏è Architecture</h3>
                                  <p>Understanding the internal architecture and design decisions of the plugin.</p>
                                  <a href="ARCHITECTURE.html">View Architecture ‚Üí</a>
                              </div>
                              <div class="card">
                                  <h3>üöÄ Publishing</h3>
                                  <p>Guide for maintainers on publishing releases to Maven Central.</p>
                                  <a href="PUBLISHING.html">View Publishing Guide ‚Üí</a>
                              </div>
                              <div class="card">
                                  <h3>üíª GitHub Repository</h3>
                                  <p>Source code, issues, and contributions on GitHub.</p>
                                  <a href="https://github.com/rajendarreddyj/tomcat-maven-plugin">View on GitHub ‚Üí</a>
                              </div>
                              <div class="card">
                                  <h3>üì¶ Maven Central</h3>
                                  <p>Download the plugin from Maven Central repository.</p>
                                  <a href="https://central.sonatype.com/artifact/io.github.rajendarreddyj/tomcat-maven-plugin">View on Maven Central ‚Üí</a>
                              </div>
                          </div>

                          <div class="quick-start">
                              <h2>Quick Start</h2>
                              <p style="margin-bottom: 1rem;">Add the plugin to your <code>pom.xml</code>:</p>
                              <pre><code>&lt;plugin&gt;
                      &lt;groupId&gt;io.github.rajendarreddyj&lt;/groupId&gt;
                      &lt;artifactId&gt;tomcat-maven-plugin&lt;/artifactId&gt;
                      &lt;version&gt;1.0.0&lt;/version&gt;
                      &lt;configuration&gt;
                          &lt;httpPort&gt;8080&lt;/httpPort&gt;
                          &lt;contextPath&gt;/myapp&lt;/contextPath&gt;
                      &lt;/configuration&gt;
                  &lt;/plugin&gt;</code></pre>
                              <p style="margin-top: 1rem;">Then run:</p>
                              <pre><code>mvn tomcat:run</code></pre>
                          </div>
                      </div>

                      <footer>
                          <p>Licensed under <a href="https://www.apache.org/licenses/LICENSE-2.0">Apache License 2.0</a></p>
                          <p>¬© 2025 <a href="https://github.com/rajendarreddyj">rajendarreddyj</a></p>
                      </footer>
                  </body>
                  </html>
                  EOF

            - name: Upload artifact
              uses: actions/upload-pages-artifact@v3
              with:
                  path: "_site"

    deploy:
        name: Deploy to GitHub Pages
        environment:
            name: github-pages
            url: ${{ steps.deployment.outputs.page_url }}
        runs-on: ubuntu-latest
        needs: build

        steps:
            - name: Deploy to GitHub Pages
              id: deployment
              uses: actions/deploy-pages@v4
